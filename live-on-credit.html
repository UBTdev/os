<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Жизнь в кредит: Путь Веб-Чародея</title>
  <link rel="stylesheet" href="./css/fonts.css">
  <link rel="stylesheet" href="./css/games/live-on-credit.css">
</head>

<body>

  <div id="gameContainer">

    <div id="menu">
      <h1>Жизнь в кредит</h1>
      <!-- <div class="menu__gui-wrapper">
      </div> -->
      <div
        style="max-width:300px; max-height:300px; background:#222; border:4px outset #8a2be2; image-rendering:pixelated;">

        <img id="titleChar" src="./img/live-on-credit/gameCbg.png" style="width:100%;height:100%;object-fit:contain;">
      </div>
      <div class="btn start-btn" onclick="startGame()">PLAY</div>
      <div class="btn" onclick="showReadme()">README.md</div>
      <div class="btn" onclick="openSettings()">SETTINGS</div>
    </div>


    <img id="bg"
      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==">
    <img id="character" src="">


    <div id="guiContainer" class="gui" style="display:none;">
      <div id="topBar">
        <div class="topBar__inner">
          <div class="stat" id="hpBar">HP 100/100</div>
          <div class="stat" id="energyBar">Энергия 100/100</div>
          <div class="stat" id="score">Счёт: 0 ₽</div>
        </div>
        <div id="gameTime">Время: 00:00</div>
      </div>


      <div id="dialogue">
        <div class="debuffs__wrapper">
          <div class="debuffs__title">Достижения</div>
          <div id="debuffs"></div>
        </div>
        <div id="speaker"></div>
        <div id="text"></div>
        <div id="choices"></div>

      </div>
    </div>
    <div class="modal-btn hide-gui-btn" onclick="toggleGui()">Скрыть / Показать GUI</div>
  </div>
  <div id="modalReadme" class="modal">
    <div class="modal-content">
      <div class="modal-title">README.md</div>
      <div class="modal-text">
        <strong>Жизнь в кредит v0.1</strong><br><br>
        Ты — Макс, должник на 300 000 ₽.<br>
        Единственный путь к свободе — совершить череду правильных решений.<br><br>
        HP — здоровье<br>
        Энергия — твои силы<br>
        Счёт — заработанные деньги<br><br>
        Прогресс сохраняется автоматически.<br>
        Удачи!
      </div>
      <div class="modal-buttons">
        <div class="modal-btn" onclick="closeModal('modalReadme')">Закрыть</div>
      </div>
    </div>
  </div>

  <div id="modalSettings" class="modal">
    <div class="modal-content">
      <div class="modal-title">Настройки</div>
      <div class="modal-text" id="settingsText">
        Выберите действие:
      </div>
      <div class="modal-buttons">
        <div class="modal-btn red" onclick="showClearConfirm()">Очистить прогресс</div>
        <div class="modal-btn" onclick="closeModal('modalSettings')">Закрыть</div>
      </div>
    </div>
  </div>

  <div id="modalClearConfirm" class="modal">
    <div class="modal-content">
      <div class="modal-title">Внимание!</div>
      <div class="modal-text">
        Вы уверены, что хотите полностью удалить весь игровой прогресс?<br>
        Это действие нельзя отменить.
      </div>
      <div class="modal-buttons">
        <div class="modal-btn red" onclick="resetGame(); closeModal('modalClearConfirm'); closeModal('modalSettings')">
          Да, удалить
        </div>
        <div class="modal-btn green" onclick="closeModal('modalClearConfirm')">
          Нет, оставить
        </div>
      </div>
    </div>
  </div>

  <div id="modalContinue" class="modal">
    <div class="modal-content">
      <div class="modal-title">Сохранение найдено</div>
      <div class="modal-text">
        Обнаружено сохранённая игра.<br>
        Продолжить с того места, где остановились?
      </div>
      <div class="modal-buttons">
        <div class="modal-btn green" onclick="startGame(); closeModal('modalContinue')">Да, продолжить</div>
        <div class="modal-btn red" onclick="resetGame(); closeModal('modalContinue')">Начать заново</div>
      </div>
    </div>
  </div>


  <audio id="typeSound"
    src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>
  <audio id="choiceSound"
    src="data:audio/wav;base64,UklGRl4AAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0Yf///5s="></audio>
  <audio id="errorSound"
    src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>

  <!-- <script src="./js/games/live-on-credit.js"></script> -->
  <script>
    // ======================== Глобальные переменные ========================
    let state = {
      hp: 100,
      maxHp: 100,
      energy: 100,
      maxEnergy: 100,
      score: 0,
      debt: 300000,
      time: 0,
      currentNode: "start",
      debuffs: [],
      visited: {}
    };

    let timerInterval = null;
    let typeInterval = null;

    // ======================== dialogi ========================
    const story = {
      // ======================== start ========================
      start: {
        bg: "./img/live-on-credit/startBG.jpg",
        char: "./img/live-on-credit/ArokenAvatar.png",
        speaker: "Глава_0:Введение:",
        text: "Тебя зовут — Максим. В попытке обеспечить свою семью, но за неимением хорошего дохода в Тинькофф банке, ты набрал долгов в 300 000 ₽. Коллекторы достают каждый день. Зарплаты не хватает и отношения на грани. Однако по знакомству предлагают работу, может там будет лучше?",
        choices: [{ text: "Пора что-то менять…", next: "warehouse_job" }]
      },

      warehouse_job: {
        bg: "./img/live-on-credit/storageBG.png",
        char: "./img/live-on-credit/boss.png",
        speaker: "Начальник:",
        text: "Максим, добро пожаловать! Зарплата 20к, но у нас тут и склад, и офис. Будешь помогать с товаром, и на работать с сайтами. По рукам?",
        choices: [{ text: "По рукам", next: "first_week_warehouse", score: 23000 }]
      },

      first_week_warehouse: {
        bg: "./img/live-on-credit/storageBG.png",
        char: "./img/live-on-credit/ArokenAvatar.png",
        speaker: "Максим (мысли):",
        text: "Утро — делали инвентаризацию. День — правил верстку в админке Битрикса. Вечер — изучаю компоненты и инфоблоки. Платят копейки, но я реально учусь.",
        onEnter: () => addDebuff("Складской разработчик", 999),
        choices: [{ text: "Прошёл первый месяц…", next: "warehouse_month_later", energy: -25, hp: -25 }]
      },

      warehouse_month_later: {
        bg: "./img/live-on-credit/storageBG.png",
        char: "./img/live-on-credit/ArokenAvatar.png",
        speaker: "Максим (мысли):",
        text: "Я уже уверенно закрываю некоторые потребности бизнеса. Понимаю PHP, компоненты. Но зарплата всё те же 23к, так ещё и с задержками… Беспокоюсь, что так мы никогда не выберемся из долгов. Однако посоветывался с Дашей и она сочла смену работы - хорошим шагом вперёд.",
        choices: [
          { text: "Бояться перемен, терпеть и ждать повышения", next: "eternal_warehouse", score: 260000, energy: -75, hp: -75 },
          { text: "Рискнуть: начать брать заказы на стороне и уйти во фриланс", next: "first_kwork", energy: -15 }
        ]
      },

      // 75 60

      // ======================== BADEND ========================
      eternal_warehouse: {
        bg: "./img/live-on-credit/storageBG.png",
        // char: "images/chars/max_old.png",
        speaker: "Плохая концовка:",
        text: "Ты стал «главным кладовщиком» на складе, с опциями веб-мастера. Зарплата выросла до 30к. Долг частично погашен… хотя прошло 4 года. Жизнь прошла мимо и без особых прекрас.  Нейтральная концовка: «Вечный складской чародей».",
        choices: [{ text: "Начать заново", action: () => resetGame() }]
      },

      // ======================== MAIN WAY ========================
      first_kwork: {
        bg: "./img/live-on-credit/desktop.jpg",
        char: "./img/live-on-credit/maksWOW.png",
        speaker: "Глава_1: Первый заказ:",
        text: "Ты зарегистрировался на Kwork. Первый заказ: «поправить верстку на сайте» — 2700 рублей. Сделал за час. Деньги пришли мгновенно. Ты позвонил Даше и удивил её тем, что заработал первые деньги в интернете.",
        onEnter: () => state.score += 2700,
        choices: [{ text: "Это работает!", next: "dasha_reaction" }]
      },

      dasha_reaction: {
        bg: "./img/live-on-credit/desktop.jpg",
        char: "./img/live-on-credit/maksCall.png",
        speaker: "Даша:",
        text: "Ого, за час ты заработал больше, чем за день на прошлой работе?! Неужели это начало чего-то большего? Ты большой молодец!\n\n*Ты чувствуешь, как эти слова тебя замотивировали*",
        choices: [{ text: "Продолжить", next: "quit_warehouse", energy: +40, hp: +25 }]
      },
      // 100 85

      quit_warehouse: {
        bg: "./img/live-on-credit/desktop.jpg",
        char: "./img/live-on-credit/maksWOW.png",
        speaker: "kwork:",
        text: "Покупатель оставил отзыв о работе. Вот его текст: 'Всё супер! Будем работать на постоянку'",
        choices: [{ text: "Мотивация так и прёт!", next: "full_freelance" }]
      },
      // 100 100

      full_freelance: {
        bg: "./img/live-on-credit/desktop.jpg",
        char: "./img/live-on-credit/ArokenAvatar.png",
        speaker: "Первый месяц:",
        text: "Прошёл месяц фриланса. 28 000 ₽. Потом 45 000 ₽. Ты ушёл с головой в заказы и самообучение.",
        onEnter: () => state.score += 28000,
        choices: [{ text: "Работать дальше", next: "burnout_trap", energy: -50, hp: -15 }]
      },

      // 50 85

      // ======================== burnout1 ========================
      burnout_trap: {
        bg: "./img/live-on-credit/csgobg.jpg",
        char: "./img/live-on-credit/maksWHTCH.png",
        speaker: "Максим (мысли):",
        text: "Вроде всё нормально, есть доход. А это значит, что можно и расслабиться! Ещё одну катку в CS… \n\nЗаказчик подождёт…",
        onEnter: () => state.score += 45000,
        choices: [
          { text: "Продолжать играть", next: "bad_end_csgo", energy: -50, hp: -75 },
          { text: "Стоп. Я скатываюсь. Нужно взять себя в руки", next: "reboot_path", energy: +10 }
        ]
      },

      bad_end_csgo: {
        bg: "./img/live-on-credit/csgolosebg.jpg",
        char: "./img/live-on-credit/maksSAD.png",
        speaker: "Плохая концовка:",
        text: "Клиенты ушли. Долг вырос до 400к. Отношения на гране. Ты снова в колл-центре, вечерами в CS:GO.\n\nПлохая концовка: «Game Over»",
        choices: [{ text: "Начать заново", action: () => resetGame() }]
      },

      // ======================== Relocation ========================
      // en 60 hp 85
      reboot_path: {
        bg: "./img/live-on-credit/relocation.jpg",
        char: "./img/live-on-credit/ArokenAvatar.png",
        speaker: "Максим:",
        text: "Переезжаю к тёще. Даша пусть ведёт бюджет. Мой план — 5000 ₽ в день. Никаких игр, пока план не выполнен.",
        onEnter: () => { state.maxEnergy += 40; addDebuff("Режим зверя", 999); },
        choices: [{ text: "Вперёд", next: "scaling", energy: +60, hp: +15 }]
      },
      // en 120 hp 100
      scaling: {
        bg: "./img/live-on-credit/newDesktop.jpg",
        // char: "./img/live-on-credit/ArokenAvatar.png",
        text: "80… 120… 180 тысяч в месяц. Ты стал настоящим профи. Старые клиенты приносят деньги даже когда ты отдыхаешь.",
        onEnter: () => state.score += 100000,
        choices: [{ text: "Расширять доход", next: "misha_offer" },
        { text: "Снова поймать сытого кота", next: "lazzy_work", energy: -60, hp: -60 }
        ]
      },
      // en 120 hp 100
      misha_offer: {
        bg: "./img/live-on-credit/newDesktop.jpg",
        char: "./img/live-on-credit/kodafavatar.png",
        speaker: "Миша Кодаф (Zoom):",
        text: "Привет, Макс! У тебя фронт и верстка — огонь, а у меня бэк. Вместе порвём рынок с твоими UI на Bootstrap и моим Бэкендом!",
        choices: [
          { text: "Остаться одиночкой — деньги не делю", next: "lone_wolf_end", energy: -60, hp: -60 },
          { text: "Делать заказы вместе!", next: "pre_true_ending", score: +101300, energy: +20 }
        ]
      },

      // ======================== end ========================
      lazzy_work: {
        bg: "./img/live-on-credit/sytyicat.jpg",
        char: "./img/live-on-credit/maksSAD.png",
        speaker: "Сытый кот:",
        text: "Постоянный доход снова идет на спад и придеться в очередной раз выбираться из этой ямы. Стресс растет. Однако дорога уже протоптана и понятно что делать...",
        choices: [{ text: "Начать заново", action: () => resetGame() }]
      },

      lone_wolf_end: {
        bg: "./img/live-on-credit/2025-11-29_02-27.png",
        // char: "images/chars/max_tired_pro.png",
        speaker: "Нейтральная концовка:",
        text: "Долги почти закрыты, но ты работаешь всё время в одиночку, часто выгораешь. Не хватает времени на жизнь и семью. Заказы есть, но ты боришься с трудностями в одиночку\nНейтральная концовка: «Одинокий волк»",
        onEnter: () => { state.maxEnergy -= 40; state.score = 100000; addDebuff("Одинокий волк!", 999); },
        choices: [{ text: "Начать заново", action: () => resetGame() }]
      },

      pre_true_ending: {
        bg: "./img/live-on-credit/sexyGirl.jpg",
        char: "./img/live-on-credit/happyMax.png",
        speaker: "Максим:",
        text: "Успех! Долги закрыты за два года!\n Мы успешно запустили свою онлайн-школу. Собрали замечательную команду \nЖивём с Дашей в Питере и зимуем в Таиланде.\n\nТот склад с коробками стал лучшим, что со мной случалось.\n\nУ меня получилось!",
        onEnter: () => { addDebuff("У меня получилось!", 999); },
        // choices: [{ text: "Далее", action: () => resetGame() }]
        choices: [{ text: "Далее", next: "true_ending" }]
      },
      true_ending: {
        bg: "./img/live-on-credit/happyteambg.jpg",
        char: "./img/live-on-credit/happyMax.png",
        text: "Поздравляю! Ты выбрался из кредитов и стал настоящим веб-чародеем!\n\nПосвящается Максиму и его команде — с огромной благодарностью за их путь и проект Арокен.ру!",
        choices: [{ text: "Вы прошли игру с хорошей концовкой", action: () => resetGame() }]
      },

  
      victory: {
        bg: "./img/live-on-credit/happyteambg.jpg",
        char: "./img/live-on-credit/happyMax.png",
        text: "Поздравляю! Ты выбрался из кредитов и стал настоящим веб-чародеем!\n\nПосвящается Максиму и его команде — с огромной благодарностью за их путь и проект Арокен.ру!",
        choices: [{ text: "Вы прошли игру с хорошей концовкой", action: () => resetGame() }]
      }
    };
    // ======================== main func ========================
    function loadGame() {
      const saved = localStorage.getItem("codeAndCredit_save");
      if (saved) {
        Object.assign(state, JSON.parse(saved));
        goTo(state.currentNode);
        startTimer();
        document.getElementById("guiContainer").style.display = "block";
        document.getElementById("menu").style.display = "none";
      }
    }

    function saveGame() {
      localStorage.setItem("codeAndCredit_save", JSON.stringify(state));
    }

    function resetGame() {
      localStorage.removeItem("codeAndCredit_save");
      location.reload();
    }

    function startGame() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("guiContainer").style.display = "block";
      loadGame() || goTo("start");
      startTimer();
    }

    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        state.time++;
        const m = String(Math.floor(state.time / 60)).padStart(2, '0');
        const s = String(state.time % 60).padStart(2, '0');
        document.getElementById("gameTime").textContent = `Время: ${m}:${s}`;
      }, 1000);
    }

    function goTo(nodeId) {
      if (!story[nodeId]) { console.error("Нет ноды", nodeId); return; }

      state.currentNode = nodeId;
      saveGame();

      const node = story[nodeId];

      // bg and character
      document.getElementById("bg").src = node.bg || "images/bg/default.png";
      document.getElementById("character").src = node.char || "";

      // speeker
      document.getElementById("speaker").textContent = node.speaker || "";

      // animation text
      const textEl = document.getElementById("text");
      textEl.textContent = "";
      clearInterval(typeInterval);
      let i = 0;
      const txt = node.text || "";
      typeInterval = setInterval(() => {
        if (i < txt.length) {
          textEl.textContent += txt[i];
          playSound("type");
          i++;
        } else clearInterval(typeInterval);
      }, 30);

      // selection
      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";

      (node.choices || []).forEach(ch => {
        const div = document.createElement("div");
        div.className = "choice gui";
        div.textContent = ch.text;
        div.onclick = () => {
          playSound("choice");

          // effects
          if (ch.hp) state.hp = Math.max(0, state.hp + ch.hp);
          if (ch.energy) state.energy = Math.max(0, state.energy + ch.energy);
          if (ch.score) state.score += ch.score;

          updateStats();

          if (ch.action) ch.action();
          else goTo(ch.next || "start");

          // game over
          if (state.hp <= 0 || state.energy <= 0) goTo("gameOver");
          // if (state.score >= state.debt) goTo("victory");
        };
        choicesDiv.appendChild(div);
      });

      // onEnter хуки
      if (node.onEnter) node.onEnter();
    }

    // ======================== stats ========================
    function updateStats() {
      document.getElementById("hpBar").textContent = `HP ${state.hp}/${state.maxHp}`;
      document.getElementById("energyBar").textContent = `Энергия ${state.energy}/${state.maxEnergy}`;
      document.getElementById("score").textContent = `Долг погашен: ${state.score} ₽ / 300000 ₽`;
    }

    function addDebuff(name, turns) {
      const exists = state.debuffs.some(debuff => debuff.name === name);

      if (!exists) {
        state.debuffs.push({ name, turns });
        renderDebuffs();
        saveGame(); 
      }

      else {
        const existing = state.debuffs.find(d => d.name === name);
        if (existing && turns > existing.turns) {
          existing.turns = turns; 
          renderDebuffs();
          saveGame();
        }
      }
    }
    function renderDebuffs() {
      const container = document.getElementById("debuffs");
      container.innerHTML = "";
      state.debuffs.forEach(d => {
        const el = document.createElement("div");
        el.className = "debuff";
        el.textContent = d.name;
        container.appendChild(el);
      });
    }

    function playSound(type) {
      const sounds = {
        type: document.getElementById("typeSound"),
        choice: document.getElementById("choiceSound"),
        error: document.getElementById("errorSound")
      };
      if (sounds[type]) sounds[type].play().catch(() => { });
    }

    // ======================== settings & README ========================

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    function openModal(id) {
      document.getElementById(id).classList.add('active');
    }

    // README
    function showReadme() {
      openModal('modalReadme');
    }

    // settings
    function openSettings() {
      openModal('modalSettings');
    }

    function toggleGui() {
      const gui = document.getElementById('guiContainer');
      const hidden = gui.style.opacity === '0';
      document.getElementById('character').style.opacity = hidden ? '1' : '0';
      document.querySelectorAll('.gui').forEach(el => {
        el.style.opacity = hidden ? '1' : '0';
        el.style.pointerEvents = hidden ? 'all' : 'none';
      });
      closeModal('modalSettings');
    }

    function showClearConfirm() {
      openModal('modalClearConfirm');
    }

    // autoload
    window.onload = () => {
      if (localStorage.getItem("codeAndCredit_save")) {
        openModal('modalContinue');
      }
    };

    
    function resetGame() {
      localStorage.removeItem("codeAndCredit_save");
      document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
      location.reload();
    }
  </script>
</body>

</html>
